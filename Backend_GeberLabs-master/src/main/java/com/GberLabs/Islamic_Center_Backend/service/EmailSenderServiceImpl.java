package com.GberLabs.Islamic_Center_Backend.service;

import jakarta.mail.Message;
import jakarta.mail.MessagingException;
import jakarta.mail.internet.InternetAddress;
import jakarta.mail.internet.MimeMessage;
import lombok.AllArgsConstructor;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;

import java.util.Random;

@Service
@AllArgsConstructor
public class EmailSenderServiceImpl implements EmailSenderService {

    private final JavaMailSender mailSender;
    private final String firstPart = "<!DOCTYPE html> <html xmlns='http://www.w3.org/1999/xhtml' xmlns:v='urn:schemas-microsoft-com:vml' xmlns:o='urn:schemas-microsoft-com:office:office' > <head> <title> </title> <!--[if !mso]><!--> <meta http-equiv='X-UA-Compatible' content='IE=edge' /> <!--<![endif]--> <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' /> <meta name='viewport' content='width=device-width, initial-scale=1' /> <style type='text/css'> #outlook a { padding: 0; } body { margin: 0; padding: 0; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } table, td { border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; } img { border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; -ms-interpolation-mode: bicubic; } p { display: block; margin: 13px 0; } </style> <!--[if mso]> <noscript> <xml> <o:OfficeDocumentSettings> <o:AllowPNG /> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml> </noscript> <![endif]--> <!--[if lte mso 11]> <style type='text/css'> .mj-outlook-group-fix { width: 100% !important; } </style> <![endif]--> <!--[if !mso]><!--> <link href='https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700' rel='stylesheet' type='text/css' /> <style type='text/css'> @import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700); </style> <!--<![endif]--> <style type='text/css'> @media only screen and (min-width: 480px) { .mj-column-per-100 { width: 100% !important; max-width: 100%; } } </style> <style media='screen and (min-width:480px)'> .moz-text-html .mj-column-per-100 { width: 100% !important; max-width: 100%; } </style> <style type='text/css'> @media only screen and (max-width: 480px) { table.mj-full-width-mobile { width: 100% !important; } td.mj-full-width-mobile { width: auto !important; } } </style> </head> <body style='word-spacing: normal'> <div style='> <!--[if mso | IE]><table align='center' border='0' cellpadding='0' cellspacing='0' class='' style='width:600px;' width='600' ><tr><td style='line-height:0px;font-size:0px;mso-line-height-rule:exactly;'><![endif]--> <div style='margin: 0px auto; max-width: 600px'> <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%' > <tbody> <tr> <td style=' direction: ltr; font-size: 0px; padding: 20px 0; text-align: center; ' > <!--[if mso | IE]><table role='presentation' border='0' cellpadding='0' cellspacing='0'><tr><td class='' style='vertical-align:top;width:600px;' ><![endif]--> <div class='mj-column-per-100 mj-outlook-group-fix' style=' font-size: 0px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%; ' > <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='vertical-align: top' width='100%' > <tbody> <tr> <td align='center' style=' font-size: 0px; padding: 10px 25px; word-break: break-word; ' > <table border='0' cellpadding='0' cellspacing='0' role='presentation' style=' border-collapse: collapse; border-spacing: 0px; ' > <tbody> <tr> <td style='width: 100px'> <img height='auto' src='https://lh3.googleusercontent.com/pw/AIL4fc9l4fw0ovNJRnfSMQp8wJJ4WNpUazhMRzEayunpB-thzfgydbaNEKGqkYJSGNrLyWNUlWncXe3-SL4LqxAMZ46rqwGmUEx1i-WZu75lACfaiRCzffRRRnfVL-AV_rwpk8WQa_v_y9U8z68s8IGaR9YK04VC6gTK3UfdrHH31ddEvLaOQijtTfFEzDNEXNqBv0rkxjwh2IfJbt3O5eq163rGEIvI5rXFd3eJwXjEpkcKIzgLW9U_hvAZXT_7JPB3jcAD9VfqYk8w9pX17lr2oV0Afp9Nbd9CrxNlRywE9nswoBMFCljvwRgtJK3yncBuxC0yI9Vs4OTGlaNsKqQb4BzP-2jpLZWgyVEEgBl5P31WDlDZ1hDVUZJf531gM8gRm0MKY1xTqh0IfuAYe5BDWMo1dnTy_BLFlrRXAx4DEKNsJdf5-QRkgcIBlnJ70kQKkU46rrmCMm16Z6jxyNvlINYzs791QcLjbgGhy9yiZ1LnskfCudx5O1yWAC8ddwHmiDsnGVqL2cZYLrziNsf3BrsdLlPLnMt093NFY8cyRRBzKUWr5JgD7Mm-886YsbWR9TBhnJ56ZB2ZCr4qoGiZTt_3AocNqtQqCVwSqa4rm5C8jlucJszp6rt6f0Lxoihs22bOS9xccKDw1rUJhZ7j3ubTdFr-sCceWolwtatoHFvtjOKcGSKCsXUnl32VbTlaK7xWi_1jHtwCy_xHv5QAy2tvO7ALoSj1y0XRiecc7JMOgBbaoMUWmNiOFDx_2iHH-j5d6Eq2T1CjjKIfVdSK6YPyPSz0BIMql0fqpAVOFc7G__o7-sUZ6ZaCJQ77ExQWVV2j1iQPccDxK4Jb9xLmrbeFr6PWQT1-ZSBbv_FlsDdOWPT9RKT_Bdtz4psnDlmY59hkAd8Ld8H8t7F4pPlSnbtTl2AScavNmsgbN_ZLEl0CRLRAu34H_xXPp0u576vIUmcmSgINKE41HqGIzFShyqpNctMjy4O_4H0Wp9yUrq27E9YOguD0Tl-mPpuGHFAfRd_fax7GHtHwM6Co59lwdEquN9zLl6Tbtag=w249-h269-s-no?authuser=4' style=' border: 0; display: block; outline: none; text-decoration: none; height: auto; width: 100%; font-size: 13px; ' width='100' /> </td> </tr> </tbody> </table> </td> </tr> <tr> <td align='center' style=' font-size: 0px; padding: 10px 25px; word-break: break-word; ' > <div style=' font-family: ; font-size: 32px; font-weight: 500; line-height: 1; text-align: center; color: #362a1c; ' > Confirm Your E-Mail Address </div> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><table align='center' border='0' cellpadding='0' cellspacing='0' class='' style='width:600px;' width='600' ><tr><td style='line-height:0px;font-size:0px;mso-line-height-rule:exactly;'><![endif]--> <div style='margin: 0px auto; max-width: 600px'> <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%' > <tbody> <tr> <td style=' direction: ltr; font-size: 0px; padding: 20px 0; text-align: center; ' > <!--[if mso | IE]><table role='presentation' border='0' cellpadding='0' cellspacing='0'><tr><td class='' style='vertical-align:top;width:600px;' ><![endif]--> <div class='mj-column-per-100 mj-outlook-group-fix' style=' font-size: 0px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%; ' > <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='vertical-align: top' width='100%' > <tbody> <tr> <td align='center' style=' font-size: 0px; padding: 10px 25px; word-break: break-word; ' > <div style=' font-family: Ubuntu, Helvetica, Arial, sans-serif; font-size: 20px; line-height: 1; text-align: center; color: #5c4930; ' > Your confirmation code is below. Enter it in the open browser window and we'll help you log in. </div> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><table align='center' border='0' cellpadding='0' cellspacing='0' class='' style='width:600px;' width='600' bgcolor='#E5DEDC' ><tr><td style='line-height:0px;font-size:0px;mso-line-height-rule:exactly;'><![endif]--> <div style=' background: #e5dedc; background-color: #e5dedc; margin: 0px auto; max-width: 600px; ' > <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='background: #e5dedc; background-color: #e5dedc; width: 100%' > <tbody> <tr> <td style=' direction: ltr; font-size: 0px; padding: 20px 0; text-align: center; ' > <!--[if mso | IE]><table role='presentation' border='0' cellpadding='0' cellspacing='0'><tr><td class='' style='vertical-align:top;width:600px;' ><![endif]--> <div class='mj-column-per-100 mj-outlook-group-fix' style=' font-size: 0px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%; ' > <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='vertical-align: top' width='100%' > <tbody> <tr> <td align='center' style=' font-size: 0px; padding: 10px 25px; word-break: break-word; ' > <div style=' font-family: Ubuntu, Helvetica, Arial, sans-serif; font-size: 32px; line-height: 1; text-align: center; color: #434245; ' >";
   private final String secondPart = "</div> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><table align='center' border='0' cellpadding='0' cellspacing='0' class='' style='width:600px;' width='600' ><tr><td style='line-height:0px;font-size:0px;mso-line-height-rule:exactly;'><![endif]--> <div style='margin: 0px auto; max-width: 600px'> <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%' > <tbody> <tr> <td style=' direction: ltr; font-size: 0px; padding: 20px 0; text-align: center; ' > <!--[if mso | IE]><table role='presentation' border='0' cellpadding='0' cellspacing='0'><tr><td class='' style='vertical-align:top;width:600px;' ><![endif]--> <div class='mj-column-per-100 mj-outlook-group-fix' style=' font-size: 0px; text-align: left; direction: ltr; display: inline-block; vertical-align: top; width: 100%; ' > <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='vertical-align: top' width='100%' > <tbody> <tr> <td align='center' style=' font-size: 0px; padding: 10px 25px; word-break: break-word; ' > <div style=' font-family: Ubuntu, Helvetica, Arial, sans-serif; font-size: 20px; line-height: 1; text-align: center; color: #997950; ' > If you haven't requested this e-mail, you can simply ignore it. </div> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </div> <!--[if mso | IE]></td></tr></table><![endif]--> </div> </body> </html>";

    @Override
    public int sendEmail(String toEmail, String subject, String body) throws MessagingException {
        MimeMessage message = mailSender.createMimeMessage();
        message.setFrom("islamichubgl@gmail.com");
        message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(toEmail));
        Random random = new Random();
        int code = random.nextInt(9000) + 1000;
        String finalMessage = firstPart +code+secondPart;
        message.setSubject(subject);

        MimeMessageHelper helper = new MimeMessageHelper(message, true);
        helper.setText(finalMessage, true); // true to indicate the text is HTML

        mailSender.send(message);
        return code;
    }
}
